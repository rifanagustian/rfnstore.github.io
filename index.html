<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Login & Register</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 50px; }
    .form-container { display: none; margin: 20px auto; padding: 20px; border: 1px solid #ccc; width: 300px; border-radius: 8px; }
    input { width: 90%; padding: 8px; margin: 6px; }
    button { padding: 10px 20px; margin: 10px; cursor: pointer; }
    .active { display: block; }
    #dashboard { display: none; margin-top: 30px; }
  </style>
  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzIQ-kAhYL54LjK2O3KD0ucZ79omPOtxb5DKQS-7E1C4RoxWEyrlHUkSVAcUU7IoFnp2A/exec";
    let currentUser = null;

    function showForm(id) {
      document.querySelectorAll(".form-container").forEach(el => el.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    async function registerUser(e) {
      e.preventDefault();
      const data = {
        action: "register",
        role: "user", // default
        fullname: document.getElementById("fullname").value,
        username: document.getElementById("reg_username").value,
        password: document.getElementById("reg_password").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value
      };

      const res = await fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      });
      const result = await res.json();
      alert(result.message);

      if (result.status === "success") {
        showForm("loginForm");
      }
    }

    async function loginUser(e) {
      e.preventDefault();
      const data = {
        action: "login",
        username: document.getElementById("login_username").value,
        password: document.getElementById("login_password").value
      };

      const res = await fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      });
      const result = await res.json();

      if (result.status === "success") {
        currentUser = result.user;
        alert(`‚úÖ Selamat datang, ${currentUser.fullname}! Anda login sebagai ${currentUser.role}`);
        showDashboard();
      } else {
        alert("‚ùå " + result.message);
      }
    }

    function showDashboard() {
      document.getElementById("auth").style.display = "none";
      document.getElementById("dashboard").style.display = "block";
      document.getElementById("userName").innerText = currentUser.fullname;
      document.getElementById("userRole").innerText = currentUser.role;
      document.getElementById("userBalance").innerText = currentUser.balance;
    }

    function logout() {
      currentUser = null;
      document.getElementById("dashboard").style.display = "none";
      document.getElementById("auth").style.display = "block";
      showForm("loginForm");
    }
  </script>
</head>
<body>
  <h1>üîê Sistem Login & Register</h1>

  <div id="auth">
    <button onclick="showForm('loginForm')">Login</button>
    <button onclick="showForm('registerForm')">Register</button>

    <!-- Login Form -->
    <div id="loginForm" class="form-container active">
      <h2>Login</h2>
      <form onsubmit="loginUser(event)">
        <input id="login_username" placeholder="Username" required><br>
        <input id="login_password" type="password" placeholder="Password" required><br>
        <button type="submit">Masuk</button>
      </form>
    </div>

    <!-- Register Form -->
    <div id="registerForm" class="form-container">
      <h2>Register</h2>
      <form onsubmit="registerUser(event)">
        <input id="fullname" placeholder="Nama Lengkap" required><br>
        <input id="reg_username" placeholder="Username" required><br>
        <input id="reg_password" type="password" placeholder="Password" required><br>
        <input id="email" type="email" placeholder="Email" required><br>
        <input id="phone" placeholder="No. WhatsApp" required><br>
        <button type="submit">Daftar</button>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard">
    <h2>Dashboard</h2>
    <p>Halo, <span id="userName"></span>!</p>
    <p>Role: <span id="userRole"></span></p>
    <p>Saldo: <span id="userBalance"></span></p>
    <button onclick="logout()">Logout</button>
  </div>
</body>
</html>
